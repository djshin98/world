<div class="section-content">
    <div id="layer-view" class="filetree" style="height:100%;">

    </div>
</div>

<script>
    app.onReady(function(_app, _map) {
        app.getOpenedMap(3).getLayerDirector().addUpdateCallback((layers) => {
            new OliveTree("#layer-view", layers, {
                onAttribute: function(d) {
                    return {
                        id: d.id
                    };
                },
                onText: function(d) {
                    return d.name;
                },
                onSelect: function(type, tag, obj) {
                    let test = {
                        General: [{
                            key: "type",
                            value: type
                        }, {
                            key: "tag",
                            value: tag
                        }],
                        Properties: Object.keys(obj).filter(key => {
                            return typeof(obj[key]) == "string" ? true : false;
                        }).map(key => {
                            return {
                                key: key,
                                value: obj[key]
                            };
                        })
                    };

                    Object.keys(obj).filter(key => {
                        return typeof(obj[key]) == "object" ? true : false;
                    }).forEach(key => {
                        let prop = obj[key]
                        test[key] = Object.keys(prop).map(k => {
                            return {
                                key: k,
                                value: prop[k]
                            };
                        });
                    });

                    app.setAttributes(test);
                },
                onChecked: function(checked, type, tag, obj) {
                    if (obj.provider && obj.options) {
                        app.getOpenedMap(3).getLayerDirector().setLayer(obj, checked, false);
                    }
                }
            });
        }, true);

    });
</script>