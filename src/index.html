<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Olive 3D version 0.2</title>
    <link rel="icon" href="img/olive.png">
    <link rel="stylesheet" type="text/css" href="libs/semantic_ui/semantic.css">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="libs/semantic_ui/semantic.js"></script>
    <link rel="stylesheet" href="css/main.css">

    <link rel="stylesheet" href="libs/jquery-treeview/jquery.treeview.css" />
    <script src="libs/jquery-treeview/jquery.treeview.js"></script>
    <script src="libs/milsymbol/kmilsymbol.development.js"></script>
    <script>

        class KMilSymbolCollection{
            constructor(viewer){
                this.viewer = viewer;
                this.entities = [];
            }
            add(cartesian, options,image){
                var obj = {
                    options:options,
                    image: image,
                    position: cartesian,
                    scaleByDistance: new Cesium.NearFarScalar(1.5e2, 1.5, 8.0e6, 0.0)
                };
                // new Cesium.BillboardGraphics(options)
                // new Entity( new Cesium.BillboardGraphics() )
                //billboards.add( obj );
                
                let entity = this.viewer.entities.add({
                    position: cartesian,
                    billboard : obj,
                    description : '<img width="60px" style="float:left; margin: 0 1em 1em 0;" src="'+obj.image+'"/>\
    <p>대한민국 군대 부호.</p>\
    <p>부호코드 : '+obj.options.sic+' </p>\
    <p>Source: <a style="color: WHITE" target="_blank" href="http://en.wikipedia.org/wiki/KMilsymbol">Wikpedia</a></p>'
                });
                this.entities.push( entity );
            }
            ids(){
                return this.entities.map(d=>{
                    return d.id;
                });
            }
            remove(id){
                let ent;
                if( this.entities.some(d=>{
                    if( d.id == id ){
                        ent = d;
                        this.viewer.entities.remove(d);
                        return true;
                    }
                    return false;
                })){
                    this.entities = this.entities.filter(d=>{
                        if( d.id == id ){
                            return false;
                        }
                        return true;
                    });
                }
            }
        }
        
        var kMilSymbolCollection;

        function dragEnter(e){
            event.preventDefault();
            return true;
        }
        function dragOver(e){
            e.preventDefault();
        }
        function drag(ev) {
            ev.dataTransfer.setData("option", ev.target.getAttribute("data-option") );
        }
        
        function dragDrop(e) {
            if( !kMilSymbolCollection ){ kMilSymbolCollection = new KMilSymbolCollection(map.viewer3d); }
            var cartesian = map.viewer3d.camera.pickEllipsoid(
                new Cesium.Cartesian3(e.clientX-300, e.clientY), map.viewer3d.scene.globe.ellipsoid);

            kMilSymbolCollection.add( cartesian , JSON.parse(decodeURIComponent(e.dataTransfer.getData("option"))) , e.dataTransfer.getData("text") );
        }

        
    </script>
</head>

<body>
    <!--
    <header>
        <img src="img/facility.png" />
        <div class="title">Web MapX3D 8.0 </div>
        <i class="window close outline"></i>
    </header>-->
    <section id="section">
        <div class="section-head item">
            <a class="ui logo icon image" href="/">
                <img src="/img/olive.png" style="width:40px;">
            </a>
            <a href="" target=”_blank”><b>MapX 3D 1.3.3</b></a>
        </div>
        <div class="section-body">
            <div class="ui vertical inverted sidebar labeled icon pointing menu visible">
            </div>
            <div class="ui vertical rectangle section-view"></div>
        </div>
        <!--
        -->
    </section>

    <article>
        <div id="door-handle"><i class="angle left icon"></i></div>
        <div class="map-cesium" id="map3d" ondragenter="return dragEnter(event)" ondrop="return dragDrop(event)" ondragover="return dragOver(event)" ></div>
        <div id="map2d"></div>
    </article>
    <footer></footer>
    <div id="popupZone">

        <div class="ui modal">
            <i class="close icon"></i>
            <div class="header">
                Profile Picture
            </div>
            <div class="image content">
                <div class="description">
                    <div class="ui header">We've auto-chosen a profile image for you.</div>
                    <p>We've grabbed the following image from the <a href="https://www.gravatar.com" target="_blank">gravatar</a> image associated with your registered e-mail address.</p>
                    <p>Is it okay to use this photo?</p>
                </div>
            </div>
            <div class="actions">
                <div class="ui black deny button">
                    Nope
                </div>
                <div class="ui positive right labeled icon button">
                    Yep, that's me
                    <i class="checkmark icon"></i>
                </div>
            </div>
        </div>

    </div>

    <script src="./libs/navigation/Cesium-Navigation.js"></script>
    <link rel="stylesheet" type="text/css" href="./libs/navigation/Cesium-Navigation.css" />
</body>

</html>