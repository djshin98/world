ui.sticky=function(o,d){var e,t,n,f,i=d.className,s=(d.namespace,d.error),c=o.querySelectorAll(d.scrollContext),l=(o[moduleNamespace],window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,0)});return f={initialize:function(){f.determineContainer(),f.determineContext(),f.verbose("Initializing sticky",d,e),f.save.positions(),f.checkErrors(),f.bind.events(),d.observeChanges&&f.observeChanges()},destroy:function(){f.verbose("Destroying previous instance"),f.reset(),t&&t.disconnect(),n&&n.disconnect()},observeChanges:function(){"MutationObserver"in window&&(t=new MutationObserver(f.event.documentChanged),n=new MutationObserver(f.event.changed),t.observe(document,{childList:!0,subtree:!0}),n.observe(o,{childList:!0,subtree:!0}),n.observe($context[0],{childList:!0,subtree:!0}),f.debug("Setting up mutation observer",n))},determineContainer:function(){e=d.container?document.querySelector(d.container):o.offsetParent},determineContext:function(){0!==(d.context?document.querySelectorAll(d.context):e).length||f.error(s.invalidContext,d.context,f)},checkErrors:function(){if(f.is.hidden()&&f.error(s.visible,f),f.cache.element.height>f.cache.context.height)return f.reset(),void f.error(s.elementSize,f)},bind:{events:function(){$window.on("load"+eventNamespace,f.event.load).on("resize"+eventNamespace,f.event.resize),$scroll.off("scroll"+eventNamespace).on("scroll"+eventNamespace,f.event.scroll).on("scrollchange"+eventNamespace,f.event.scrollchange)}},event:{changed:function(e){clearTimeout(f.timer),f.timer=setTimeout(function(){f.verbose("DOM tree modified, updating sticky menu",e),f.refresh()},100)},documentChanged:function(e){[].forEach.call(e,function(e){e.removedNodes&&[].forEach.call(e.removedNodes,function(e){(e==o||0<$(e).find(o).length)&&(f.debug("Element removed from DOM, tearing down events"),f.destroy())})})},load:function(){f.verbose("Page contents finished loading"),l(f.refresh)},resize:function(){f.verbose("Window resized"),l(f.refresh)},scroll:function(){l(function(){$scroll.triggerHandler("scrollchange"+eventNamespace,$scroll.scrollTop())})},scrollchange:function(e,t){f.stick(t),d.onScroll.call(o)}},refresh:function(e){f.reset(),d.context||f.determineContext(),e&&f.determineContainer(),f.save.positions(),f.stick(),d.onReposition.call(o)},supports:{sticky:function(){var e=$("<div/>");e[0];return e.classList.add(i.supported),e.css("position").match("sticky")}},save:{lastScroll:function(e){f.lastScroll=e},elementScroll:function(e){f.elementScroll=e},positions:function(){var e={height:$scroll.height()},t={margin:{top:parseInt($module.css("margin-top"),10),bottom:parseInt($module.css("margin-bottom"),10)},offset:$module.offset(),width:$module.outerWidth(),height:$module.outerHeight()},o={offset:$context.offset(),height:$context.outerHeight()};$container.outerHeight();f.is.standardScroll()||(f.debug("Non-standard scroll. Removing scroll offset from element offset"),e.top=$scroll.scrollTop(),e.left=$scroll.scrollLeft(),t.offset.top+=e.top,o.offset.top+=e.top,t.offset.left+=e.left,o.offset.left+=e.left),f.cache={fits:t.height+d.offset<=e.height,sameHeight:t.height==o.height,scrollContext:{height:e.height},element:{margin:t.margin,top:t.offset.top-t.margin.top,left:t.offset.left,width:t.width,height:t.height,bottom:t.offset.top+t.height},context:{top:o.offset.top,height:o.height,bottom:o.offset.top+o.height}},f.set.containerSize(),f.stick(),f.debug("Caching element positions",f.cache)}},get:{direction:function(e){var t="down";return e=e||$scroll.scrollTop(),void 0!==f.lastScroll&&(f.lastScroll<e?t="down":f.lastScroll>e&&(t="up")),t},scrollChange:function(e){return e=e||$scroll.scrollTop(),f.lastScroll?e-f.lastScroll:0},currentElementScroll:function(){return f.elementScroll?f.elementScroll:f.is.top()?Math.abs(parseInt($module.css("top"),10))||0:Math.abs(parseInt($module.css("bottom"),10))||0},elementScroll:function(e){e=e||$scroll.scrollTop();var t=f.cache.element,o=f.cache.scrollContext,n=f.get.scrollChange(e),i=t.height-o.height+d.offset,s=f.get.currentElementScroll(),c=s+n;return s=f.cache.fits||c<0?0:i<c?i:c}},remove:{lastScroll:function(){delete f.lastScroll},elementScroll:function(e){delete f.elementScroll},minimumSize:function(){$container.css("min-height","")},offset:function(){$module.css("margin-top","")}},set:{offset:function(){f.verbose("Setting offset on element",d.offset),$module.css("margin-top",d.offset)},containerSize:function(){var e=$container.get(0).tagName;"HTML"===e||"body"==e?f.determineContainer():Math.abs($container.outerHeight()-f.cache.context.height)>d.jitter&&(f.debug("Context has padding, specifying exact height for container",f.cache.context.height),$container.css({height:f.cache.context.height}))},minimumSize:function(){var e=f.cache.element;$container.css("min-height",e.height)},scroll:function(e){f.debug("Setting scroll on element",e),f.elementScroll!=e&&(f.is.top()&&$module.css("bottom","").css("top",-e),f.is.bottom()&&$module.css("top","").css("bottom",e))},size:function(){0!==f.cache.element.height&&0!==f.cache.element.width&&(o.style.setProperty("width",f.cache.element.width+"px","important"),o.style.setProperty("height",f.cache.element.height+"px","important"))}},is:{standardScroll:function(){return c[0]==window},top:function(){return o.classList.contains(i.top)},bottom:function(){return o.classList.contains(i.bottom)},initialPosition:function(){return!f.is.fixed()&&!f.is.bound()},hidden:function(){return!ui.isVisible(o)},bound:function(){return o.classList.contains(i.bound)},fixed:function(){return o.classList.contains(i.fixed)}},stick:function(e){var t=e||$scroll.scrollTop(),o=f.cache,n=o.fits,i=o.sameHeight,s=o.element,c=o.scrollContext,l=o.context,r=f.is.bottom()&&d.pushing?d.bottomOffset:d.offset,a=(e={top:t+r,bottom:t+r+c.height},f.get.direction(e.top),n?0:f.get.elementScroll(e.top)),m=!n;0!==s.height&&!i&&(f.is.initialPosition()?e.top>=l.bottom?(f.debug("Initial element position is bottom of container"),f.bindBottom()):e.top>s.top&&(s.height+e.top-a>=l.bottom?(f.debug("Initial element position is bottom of container"),f.bindBottom()):(f.debug("Initial element position is fixed"),f.fixTop())):f.is.fixed()?f.is.top()?e.top<=s.top?(f.debug("Fixed element reached top of container"),f.setInitialPosition()):s.height+e.top-a>=l.bottom?(f.debug("Fixed element reached bottom of container"),f.bindBottom()):m&&(f.set.scroll(a),f.save.lastScroll(e.top),f.save.elementScroll(a)):f.is.bottom()&&(e.bottom-s.height<=s.top?(f.debug("Bottom fixed rail has reached top of container"),f.setInitialPosition()):e.bottom>=l.bottom?(f.debug("Bottom fixed rail has reached bottom of container"),f.bindBottom()):m&&(f.set.scroll(a),f.save.lastScroll(e.top),f.save.elementScroll(a))):f.is.bottom()&&(e.top<=s.top?(f.debug("Jumped from bottom fixed to top fixed, most likely used home/end button"),f.setInitialPosition()):d.pushing?f.is.bound()&&e.bottom<=l.bottom&&(f.debug("Fixing bottom attached element to bottom of browser."),f.fixBottom()):f.is.bound()&&e.top<=l.bottom-s.height&&(f.debug("Fixing bottom attached element to top of browser."),f.fixTop())))},bindTop:function(){f.debug("Binding element to top of parent container"),f.remove.offset(),$module.css({left:"",top:"",marginBottom:""}).classList.remove(i.fixed).classList.remove(i.bottom).classList.add(i.bound).classList.add(i.top),d.onTop.call(o),d.onUnstick.call(o)},bindBottom:function(){f.debug("Binding element to bottom of parent container"),f.remove.offset(),$module.css({left:"",top:""}).classList.remove(i.fixed).classList.remove(i.top).classList.add(i.bound).classList.add(i.bottom),d.onBottom.call(o),d.onUnstick.call(o)},setInitialPosition:function(){f.debug("Returning to initial position"),f.unfix(),f.unbind()},fixTop:function(){f.debug("Fixing element to top of page"),d.setSize&&f.set.size(),f.set.minimumSize(),f.set.offset(),$module.css({left:f.cache.element.left,bottom:"",marginBottom:""}).classList.remove(i.bound).classList.remove(i.bottom).classList.add(i.fixed).classList.add(i.top),d.onStick.call(o)},fixBottom:function(){f.debug("Sticking element to bottom of page"),d.setSize&&f.set.size(),f.set.minimumSize(),f.set.offset(),$module.css({left:f.cache.element.left,bottom:"",marginBottom:""}).classList.remove(i.bound).classList.remove(i.top).classList.add(i.fixed).classList.add(i.bottom),d.onStick.call(o)},unbind:function(){f.is.bound()&&(f.debug("Removing container bound position on element"),f.remove.offset(),o.classList.remove(i.bound),o.classList.remove(i.top),o.classList.remove(i.bottom))},unfix:function(){f.is.fixed()&&(f.debug("Removing fixed position on element"),f.remove.minimumSize(),f.remove.offset(),o.classList.remove(i.fixed),o.classList.remove(i.top),o.classList.remove(i.bottom),d.onUnstick.call(o))},reset:function(){f.debug("Resetting elements position"),f.unbind(),f.unfix(),f.resetCSS(),f.remove.offset(),f.remove.lastScroll()},resetCSS:function(){$module.css({width:"",height:""}),$container.css({height:""})}}},ui.sticky.settings={name:"Sticky",namespace:"sticky",silent:!1,debug:!1,verbose:!0,performance:!0,pushing:!1,context:!1,container:!1,scrollContext:window,offset:0,bottomOffset:0,jitter:5,setSize:!0,observeChanges:!1,onReposition:function(){},onScroll:function(){},onStick:function(){},onUnstick:function(){},onTop:function(){},onBottom:function(){},error:{container:"Sticky element must be inside a relative container",visible:"Element is hidden, you must call refresh after element becomes visible. Use silent setting to surpress this warning in production.",method:"The method you called is not defined.",invalidContext:"Context specified does not exist",elementSize:"Sticky element is larger than its container, cannot create sticky."},className:{bound:"bound",fixed:"fixed",supported:"native",top:"top",bottom:"bottom"}};